<!DOCTYPE html>
<html lang="ja" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CJ-Lab | 独立系政策ラボラトリー</title>
    <meta name="description" content="エビデンスに基づく政策提言で日中関係の前進、日本の国力を高めます。日中両国にとってのあるべき戦略を描く政策ラボです。">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Noto+Serif+JP:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        navy: {
                            DEFAULT: '#0B1F3B',
                            light: '#1A365D',
                            dark: '#051024',
                        },
                        body: '#333333',
                        surface: '#F8F9FA',
                    },
                    fontFamily: {
                        sans: ['"Noto Sans JP"', 'sans-serif'],
                        serif: ['"Noto Serif JP"', 'serif'],
                    },
                }
            }
        }
    </script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body {
            color: #333333;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .fade-up {
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.8s cubic-bezier(0.16, 1, 0.3, 1), transform 0.8s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .fade-up.is-visible {
            opacity: 1;
            transform: translateY(0);
        }

        p {
            line-height: 1.8;
            letter-spacing: 0.02em;
        }
        h1, h2, h3, h4 {
            letter-spacing: 0.05em;
        }

        .spinner {
            border: 2px solid rgba(0, 0, 0, 0.1);
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border-left-color: currentColor;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* 認証前の管理画面を隠す */
        #admin-section {
            display: none;
        }

        #admin-section.authorized {
            display: block;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #0B1F3B;
        }
    </style>
</head>
<body class="bg-white font-sans text-body">

    <!-- Navigation -->
    <header class="fixed w-full top-0 z-50 bg-white/95 backdrop-blur-sm border-b border-gray-200 transition-all duration-300" id="navbar">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">
                <div class="flex-shrink-0 flex items-center">
                    <a href="#" class="font-serif font-bold text-2xl md:text-3xl text-navy flex items-center gap-2">
                        <i data-lucide="landmark" class="w-7 h-7 md:w-8 md:h-8"></i>
                        <span>CJ-Lab</span>
                    </a>
                </div>
                
                <nav class="hidden lg:flex space-x-8">
                    <a href="#about" class="text-sm font-bold tracking-widest uppercase text-body hover:text-navy transition-colors">About</a>
                    <a href="#insights" class="text-sm font-bold tracking-widest uppercase text-body hover:text-navy transition-colors">News</a>
                    <a href="#research" class="text-sm font-bold tracking-widest uppercase text-body hover:text-navy transition-colors">Research</a>
                    <a href="#contact" class="text-sm font-bold tracking-widest uppercase text-navy border-b-2 border-navy/20">Contact</a>
                </nav>

                <!-- 管理者ログインボタン -->
                <div class="hidden md:flex items-center">
                    <button id="admin-login-trigger" class="flex items-center gap-2 text-gray-300 hover:text-navy px-4 py-2 text-[10px] font-bold transition-colors duration-200 uppercase tracking-tighter">
                        <i data-lucide="lock" class="w-3 h-3"></i>
                        Staff Only
                    </button>
                </div>

                <div class="flex items-center lg:hidden">
                    <button type="button" id="mobile-menu-button" class="text-gray-500 hover:text-navy focus:outline-none p-2">
                        <i data-lucide="menu" class="w-6 h-6" id="menu-icon"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Mobile Menu -->
        <div class="lg:hidden hidden bg-white border-t border-gray-100" id="mobile-menu">
            <div class="px-2 pt-2 pb-6 space-y-1 sm:px-3 shadow-lg font-bold uppercase tracking-widest text-xs">
                <a href="#about" class="block px-3 py-4 text-body hover:bg-surface hover:text-navy">About Us</a>
                <a href="#insights" class="block px-3 py-4 text-body hover:bg-surface hover:text-navy">Latest News</a>
                <a href="#research" class="block px-3 py-4 text-body hover:bg-surface hover:text-navy">Research Portfolio</a>
                <a href="#contact" class="block px-3 py-4 text-navy bg-surface">Contact Info</a>
            </div>
        </div>
    </header>

    <main>
        <!-- Hero Section -->
        <section class="relative pt-32 pb-16 md:pt-48 md:pb-24 flex items-center min-h-[85vh]">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10 w-full">
                <div class="max-w-5xl fade-up">
                    <span class="block text-sm font-bold tracking-widest text-navy uppercase mb-6 flex items-center gap-3">
                        <span class="w-10 h-[1px] bg-navy"></span>
                        Independent Policy Laboratory
                    </span>
                    <h1 class="text-4xl md:text-5xl lg:text-7xl font-serif font-semibold text-navy leading-tight mb-12">
                        エビデンスに基づく提言で<br class="hidden md:block">日中関係を再定義する。
                    </h1>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-10">
                        <div class="space-y-6 text-gray-600 font-sans font-light">
                            <p class="text-lg md:text-xl leading-relaxed">
                                CJ-Labは、日中両国にとっての「あるべき戦略」を客観的データと多角的な分析に基づいて描き出す、独立系政策ラボラトリーです。
                            </p>
                        </div>
                        <div class="flex flex-col sm:flex-row items-start lg:items-end gap-4">
                            <a href="#insights" class="w-full sm:w-auto inline-flex justify-center items-center px-10 py-4 bg-navy text-white text-sm font-bold hover:bg-navy-light transition-all duration-300 rounded-sm tracking-widest">
                                最新の論考を見る
                            </a>
                            <a href="#contact" class="w-full sm:w-auto inline-flex justify-center items-center px-10 py-4 border border-navy text-navy text-sm font-bold hover:bg-surface transition-all duration-300 rounded-sm tracking-widest">
                                お問い合わせ
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- News & Insights -->
        <section id="insights" class="py-24 border-y border-gray-100 bg-surface/50">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="grid grid-cols-1 lg:grid-cols-12 gap-12 fade-up">
                    <div class="lg:col-span-4">
                        <h2 class="text-xs font-bold tracking-widest text-navy/40 uppercase mb-4">News & Updates</h2>
                        <h3 class="text-3xl font-serif font-semibold text-navy mb-8">最新情報</h3>
                        <p class="text-gray-600 text-sm mb-8 leading-loose">
                            弊ラボによる緊急提言、メディア掲載、最新の調査レポートを時系列で掲載しています。
                        </p>
                    </div>
                    
                    <div class="lg:col-span-8">
                        <div id="loading-reports" class="py-12 flex justify-center items-center gap-3 text-gray-400 italic">
                            <div class="spinner"></div>
                            最新のデータを取得中...
                        </div>
                        <div id="report-list" class="space-y-0">
                            <!-- Firebase data will be injected here -->
                        </div>
                        <div id="no-reports" class="hidden py-12 text-center border border-dashed border-gray-200 rounded-lg">
                            <p class="text-gray-400 text-sm italic tracking-widest">NO RECENT UPDATES</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Research Areas -->
        <section id="research" class="py-24 md:py-32">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="mb-20 fade-up">
                    <h2 class="text-xs font-bold tracking-widest text-navy/40 uppercase mb-4">Research Portfolio</h2>
                    <h3 class="text-3xl md:text-4xl font-serif font-semibold text-navy">主要研究分野</h3>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-0 border border-gray-200 divide-y md:divide-y-0 md:divide-x divide-gray-200 fade-up">
                    <div class="p-12 hover:bg-surface transition-all">
                        <i data-lucide="microscope" class="w-8 h-8 mb-8 text-navy/40"></i>
                        <h4 class="text-xl font-serif font-bold text-navy mb-4">先端技術と経済安保</h4>
                        <p class="text-gray-600 text-sm font-light leading-relaxed">半導体、AI、量子技術における日中間の技術覇権とサプライチェーンの強靭化に関する研究。</p>
                    </div>
                    <div class="p-12 hover:bg-surface transition-all">
                        <i data-lucide="bar-chart-3" class="w-8 h-8 mb-8 text-navy/40"></i>
                        <h4 class="text-xl font-serif font-bold text-navy mb-4">マクロ経済・金融動態</h4>
                        <p class="text-gray-600 text-sm font-light leading-relaxed">中国のデフレ圧力、不動産市場、および円・人民元の為替動向が日本経済に与える影響の分析。</p>
                    </div>
                    <div class="p-12 hover:bg-surface transition-all">
                        <i data-lucide="compass" class="w-8 h-8 mb-8 text-navy/40"></i>
                        <h4 class="text-xl font-serif font-bold text-navy mb-4">地政学的リスク管理</h4>
                        <p class="text-gray-600 text-sm font-light leading-relaxed">台湾海峡情勢、多国間枠組みにおける外交戦略、および企業のカントリーリスク評価。</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- About -->
        <section id="about" class="py-24 md:py-32 bg-navy text-white relative overflow-hidden">
            <div class="absolute top-0 right-0 w-1/2 h-full bg-white/5 skew-x-12 translate-x-32"></div>
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
                <div class="max-w-4xl fade-up">
                    <div class="mb-16">
                        <h2 class="text-xs font-bold tracking-widest text-white/40 uppercase mb-4">Philosophy</h2>
                        <h3 class="text-3xl md:text-5xl font-serif font-semibold leading-tight">
                            「感情」ではなく「エビデンス」を、<br>「対立」ではなく「戦略」を。
                        </h3>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-16 text-white/70 font-sans font-light">
                        <div class="space-y-6">
                            <p class="text-base md:text-lg leading-relaxed">
                                複雑化する国際環境の中で、日中関係は冷静で戦略的な選択を必要としています。私たちは制度、産業、資源、技術、人口動態、地政学的リスクといった複数のレイヤーを統合し、将来シナリオを描きます。
                            </p>
                        </div>
                        <div class="space-y-6 text-base md:text-lg leading-relaxed">
                            <p>
                                重要なのは、実行可能であること、持続可能であること、および戦略として一貫していることです。CJ-Labは、短期的な政策論争を超え、中長期的視野から政策の優先順位と選択肢を明確化します。
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Contact Section -->
        <section id="contact" class="py-24 md:py-32 bg-white">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-20 items-center fade-up">
                    <div>
                        <h2 class="text-xs font-bold tracking-widest text-navy/40 uppercase mb-4">Contact</h2>
                        <h3 class="text-3xl md:text-5xl font-serif font-semibold text-navy mb-8 leading-tight">お問い合わせ</h3>
                        <p class="text-gray-600 mb-12 text-lg font-light leading-relaxed">
                            共同研究、メディア取材、講演依頼、および弊ラボの活動に関するご質問は、以下のフォームよりお送りください。
                        </p>
                        <div class="flex items-center gap-6">
                            <div class="w-12 h-12 rounded-full border border-navy/10 flex items-center justify-center text-navy">
                                <i data-lucide="mail" class="w-5 h-5"></i>
                            </div>
                            <div>
                                <p class="text-[10px] text-gray-400 font-bold uppercase tracking-widest">Inquiry Email</p>
                                <p class="font-medium text-navy">contact@cj-lab.example.org</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-surface p-8 md:p-12 border border-gray-100 rounded-sm">
                        <form id="contact-form" class="space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-2">お名前 / 氏名</label>
                                    <input type="text" id="contact-name" required class="w-full px-4 py-3 bg-white border border-gray-200 focus:border-navy focus:outline-none text-sm transition-colors rounded-sm">
                                </div>
                                <div>
                                    <label class="block text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-2">所属機関</label>
                                    <input type="text" id="contact-org" class="w-full px-4 py-3 bg-white border border-gray-200 focus:border-navy focus:outline-none text-sm transition-colors rounded-sm">
                                </div>
                            </div>
                            <div>
                                <label class="block text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-2">メールアドレス</label>
                                <input type="email" id="contact-email" required class="w-full px-4 py-3 bg-white border border-gray-200 focus:border-navy focus:outline-none text-sm transition-colors rounded-sm">
                            </div>
                            <div>
                                <label class="block text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-2">メッセージ内容</label>
                                <textarea id="contact-message" rows="5" required class="w-full px-4 py-3 bg-white border border-gray-200 focus:border-navy focus:outline-none text-sm transition-colors rounded-sm"></textarea>
                            </div>
                            <button type="submit" id="contact-submit" class="w-full bg-navy text-white py-4 font-bold text-xs uppercase tracking-[0.2em] hover:bg-navy-light transition-all flex justify-center items-center gap-2 rounded-sm shadow-sm">
                                <i data-lucide="send" class="w-3.5 h-3.5"></i>
                                Send Message
                            </button>
                        </form>
                        <div id="contact-status" class="mt-4 text-center text-xs font-bold hidden"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Admin Section -->
        <section id="admin-section" class="py-24 bg-gray-50 border-t border-gray-100">
            <div class="max-w-3xl mx-auto px-4">
                <div class="bg-white p-10 border border-gray-200 shadow-sm rounded-sm">
                    <div class="flex justify-between items-center mb-10">
                        <div>
                            <h3 class="text-xs font-bold text-gray-400 tracking-[0.3em] uppercase mb-2">Staff Terminal</h3>
                            <p class="text-2xl font-serif text-navy">レポート新規投稿</p>
                        </div>
                        <button id="admin-logout" class="text-[10px] font-bold text-red-400 hover:text-red-600 uppercase tracking-widest">Logout</button>
                    </div>
                    
                    <form id="report-form" class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-2">公開日</label>
                                <input type="date" id="form-date" required class="w-full px-4 py-2 bg-surface border border-gray-200 text-sm focus:outline-none">
                            </div>
                            <div>
                                <label class="block text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-2">カテゴリ</label>
                                <select id="form-category" class="w-full px-4 py-2 bg-surface border border-gray-200 text-sm focus:outline-none font-bold">
                                    <option value="POLICY">政策提言</option>
                                    <option value="INSIGHT">論考</option>
                                    <option value="NEWS">ニュース</option>
                                    <option value="EVENT">イベント報告</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label class="block text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-2">タイトル</label>
                            <input type="text" id="form-title" required placeholder="レポートの題名" class="w-full px-4 py-2 bg-surface border border-gray-200 text-sm focus:outline-none">
                        </div>
                        <div>
                            <label class="block text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-2">概要（サマリー）</label>
                            <textarea id="form-summary" rows="3" required placeholder="150文字程度の要約" class="w-full px-4 py-2 bg-surface border border-gray-200 text-sm focus:outline-none"></textarea>
                        </div>
                        <div>
                            <label class="block text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-2">外部リンク URL（Google Drive等）</label>
                            <input type="url" id="form-url" placeholder="https://drive.google.com/..." class="w-full px-4 py-2 bg-surface border border-gray-200 text-sm focus:outline-none">
                        </div>
                        
                        <button type="submit" id="submit-btn" class="w-full bg-navy text-white py-4 text-xs font-bold uppercase tracking-[0.3em] hover:bg-navy-light transition-all rounded-sm">
                            Publish Insight
                        </button>
                    </form>
                    <div id="status-message" class="mt-4 text-center text-sm font-bold hidden"></div>
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-white border-t border-gray-100 pt-20 pb-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col md:flex-row justify-between items-center gap-12 mb-16">
                <div class="flex flex-col items-center md:items-start gap-4">
                    <div class="font-serif font-bold text-2xl text-navy">CJ-Lab</div>
                    <p class="text-xs text-gray-400 tracking-widest font-light">Evidence-Based Strategy For Future Relations.</p>
                </div>
                <nav class="flex flex-wrap justify-center gap-10 text-[10px] font-bold text-gray-400 uppercase tracking-widest">
                    <a href="#about" class="hover:text-navy transition-colors">About</a>
                    <a href="#insights" class="hover:text-navy transition-colors">News</a>
                    <a href="#research" class="hover:text-navy transition-colors">Research</a>
                    <a href="#contact" class="hover:text-navy transition-colors">Contact</a>
                </nav>
            </div>
            <div class="text-center text-[10px] text-gray-300 font-bold tracking-[0.2em] uppercase border-t border-gray-50 pt-10">
                <p>&copy; 2026 CJ-Lab. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global state
        let app, auth, db, user = null;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'cj-lab-official';
        const ADMIN_PASS = "admin123";

        // Firebase Config Loading
        let firebaseConfig = null;
        try {
            if (typeof __firebase_config !== 'undefined' && __firebase_config) {
                firebaseConfig = JSON.parse(__firebase_config);
            }
        } catch (e) {
            console.error("Firebase config parse error:", e);
        }

        const isFirebaseReady = firebaseConfig && firebaseConfig.apiKey;

        if (isFirebaseReady) {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);

            const initAuth = async () => {
                try {
                    if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                        await signInWithCustomToken(auth, __initial_auth_token);
                    } else {
                        await signInAnonymously(auth);
                    }
                    console.log("Firebase Auth initialized.");
                } catch (err) { 
                    console.error("Auth failed:", err); 
                }
            };

            onAuthStateChanged(auth, (u) => {
                user = u;
                if (user) {
                    console.log("Logged in as:", user.uid);
                    loadReports();
                }
            });

            initAuth();
        } else {
            const loadingEl = document.getElementById('loading-reports');
            if (loadingEl) loadingEl.innerHTML = "Firebase configuration is missing. Please check your environment variables.";
            console.error("Firebase configuration is missing. Database features will be unavailable.");
        }

        function loadReports() {
            if (!user || !db) return;
            const reportsRef = collection(db, 'artifacts', appId, 'public', 'data', 'reports');
            
            onSnapshot(reportsRef, (snapshot) => {
                const reportList = document.getElementById('report-list');
                const loading = document.getElementById('loading-reports');
                const noReports = document.getElementById('no-reports');
                
                if(loading) loading.classList.add('hidden');
                if(reportList) reportList.innerHTML = '';

                let reports = [];
                snapshot.forEach((doc) => reports.push({ id: doc.id, ...doc.data() }));
                reports.sort((a, b) => new Date(b.date) - new Date(a.date));

                if (reports.length === 0) {
                    if(noReports) noReports.classList.remove('hidden');
                } else {
                    if(noReports) noReports.classList.add('hidden');
                    reports.forEach((report) => {
                        const article = document.createElement('article');
                        article.className = 'group py-10 border-b border-gray-100 first:pt-0';
                        
                        let linkHTML = report.url ? `
                            <div class="mt-6">
                                <a href="${report.url}" target="_blank" rel="noopener noreferrer" class="inline-flex items-center text-[10px] font-bold text-navy hover:text-navy-light tracking-[0.2em] uppercase border-b border-navy/20 pb-1 transition-all">
                                    Read Detailed Report <i data-lucide="arrow-right" class="w-3 h-3 ml-2"></i>
                                </a>
                            </div>
                        ` : '';

                        article.innerHTML = `
                            <div class="flex items-center gap-4 mb-4">
                                <time class="text-xs font-mono font-bold text-gray-400 tracking-tighter">${(report.date || '').replace(/-/g, '.')}</time>
                                <span class="text-[9px] font-bold text-navy tracking-widest uppercase border border-navy/10 px-2 py-0.5 rounded-sm">${report.category}</span>
                            </div>
                            <h4 class="text-xl md:text-2xl font-serif font-medium text-navy mb-4 group-hover:text-navy-light transition-colors">
                                ${report.title}
                            </h4>
                            <p class="text-gray-500 text-sm leading-relaxed max-w-4xl font-light">
                                ${report.summary}
                            </p>
                            ${linkHTML}
                        `;
                        reportList.appendChild(article);
                    });
                    lucide.createIcons();
                }
            }, (err) => console.error("Firestore read error:", err));
        };

        // Admin Access Logic
        const loginTrigger = document.getElementById('admin-login-trigger');
        const adminSection = document.getElementById('admin-section');
        const logoutBtn = document.getElementById('admin-logout');

        loginTrigger.addEventListener('click', () => {
            const input = prompt("管理者パスワードを入力してください:");
            if (input === ADMIN_PASS) {
                adminSection.classList.add('authorized');
                adminSection.scrollIntoView({ behavior: 'smooth' });
            } else if (input !== null) {
                alert("パスワードが正しくありません。");
            }
        });

        logoutBtn.addEventListener('click', () => {
            adminSection.classList.remove('authorized');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Forms Logic
        const reportForm = document.getElementById('report-form');
        const contactForm = document.getElementById('contact-form');

        if (reportForm) {
            reportForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                // Firebase check
                if (!isFirebaseReady || !db || !user) {
                    alert("Firebaseが初期化されていないため、投稿できません。");
                    return;
                }

                const submitBtn = document.getElementById('submit-btn');
                const statusMsg = document.getElementById('status-message');
                submitBtn.disabled = true;
                submitBtn.textContent = 'PUBLISHING...';

                try {
                    const reportsRef = collection(db, 'artifacts', appId, 'public', 'data', 'reports');
                    const payload = {
                        title: document.getElementById('form-title').value,
                        date: document.getElementById('form-date').value,
                        category: document.getElementById('form-category').value,
                        summary: document.getElementById('form-summary').value,
                        url: document.getElementById('form-url').value,
                        createdAt: new Date().toISOString()
                    };

                    await addDoc(reportsRef, payload);
                    
                    statusMsg.textContent = "投稿が完了しました。";
                    statusMsg.className = "mt-4 text-center text-sm font-bold text-green-600 block";
                    reportForm.reset();
                } catch (err) {
                    console.error("Submission error:", err);
                    statusMsg.textContent = "投稿に失敗しました: " + err.message;
                    statusMsg.className = "mt-4 text-center text-sm font-bold text-red-600 block";
                } finally {
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Publish Insight';
                    setTimeout(() => statusMsg.classList.add('hidden'), 5000);
                }
            });
        }

        if (contactForm) {
            contactForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                if (!isFirebaseReady || !db || !user) {
                    alert("システム準備中です。しばらくお待ちください。");
                    return;
                }
                const contactSubmit = document.getElementById('contact-submit');
                contactSubmit.disabled = true;
                contactSubmit.textContent = 'SENDING...';

                try {
                    const contactRef = collection(db, 'artifacts', appId, 'users', user.uid, 'inquiries');
                    await addDoc(contactRef, {
                        name: document.getElementById('contact-name').value,
                        org: document.getElementById('contact-org').value,
                        email: document.getElementById('contact-email').value,
                        message: document.getElementById('contact-message').value,
                        timestamp: new Date().toISOString()
                    });
                    document.getElementById('contact-status').textContent = '送信完了いたしました。';
                    document.getElementById('contact-status').className = 'mt-4 text-center text-xs font-bold text-green-600 block';
                    contactForm.reset();
                } catch (err) {
                    console.error("Contact error:", err);
                    document.getElementById('contact-status').textContent = '送信に失敗しました。';
                    document.getElementById('contact-status').className = 'mt-4 text-center text-xs font-bold text-red-600 block';
                } finally {
                    contactSubmit.disabled = false;
                    contactSubmit.textContent = 'Send Message';
                }
            });
        }

        // UI Helpers
        lucide.createIcons();
        document.getElementById('mobile-menu-button').addEventListener('click', () => {
            const menu = document.getElementById('mobile-menu');
            const icon = document.getElementById('menu-icon');
            menu.classList.toggle('hidden');
            icon.setAttribute('data-lucide', menu.classList.contains('hidden') ? 'menu' : 'x');
            lucide.createIcons();
        });

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('is-visible');
                    observer.unobserve(entry.target);
                }
            });
        }, { threshold: 0.1 });
        document.querySelectorAll('.fade-up').forEach(el => observer.observe(el));
    </script>
</body>
</html>
